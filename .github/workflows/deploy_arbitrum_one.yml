name: Deploy Arbitrum One

on:
  push:
    branches:
      - production
    paths:
      - 'package.json'

  workflow_dispatch:

jobs:
  Deploy:
    env:
      GOLDSKY_TOKEN: ${{ secrets.GOLDSKY_TOKEN }}
      ORMI_TOKEN: ${{ secrets.ORMI_TOKEN }}
      THE_GRAPH_TOKEN: ${{ secrets.THE_GRAPH_TOKEN }}

      NETWORK: arbitrum-one

      ADDRESS_BOOK: '0xCa19F26c52b11186B4b1e76a662a14DA5149EA5a'
      ADDRESS_BOOK_BLOCK: 24287589
      ALPHA_PORTFOLIO_VALUES_FEED: '0xc7AbaEc336098Cd0dcD98b67cb14d3B18e1c68A8'
      ALPHA_PORTFOLIO_VALUES_FEED_BLOCK: 132185781
      CONTROLLER: '0x594bD4eC29F7900AE29549c140Ac53b5240d4019'
      CONTROLLER_BLOCK: 24287805
      DISPERSE: '0x77617bCb00f497f53Ce8fDf70e405BaB612c2Aa6'
      DISPERSE_BLOCK: 147725964
      LIQUIDITY_POOL: '0x217749d9017cB87712654422a1F5856AAA147b80'
      LIQUIDITY_POOL_BLOCK: 105498017
      OPTION_CATALOGUE: '0x44227Dc2a1d71FC07DC254Dfd42B1C44aFF12168'
      OPTION_CATALOGUE_BLOCK: 105498997
      OPTION_EXCHANGE: '0xC117bf3103bd09552F9a721F0B8Bce9843aaE1fa'
      OPTION_EXCHANGE_BLOCK: 105499283
      ORACLE: '0xBA1880CFFE38DD13771CB03De896460baf7dA1E7'
      ORACLE_BLOCK: 24287677
      OTOKEN_FACTORY: '0xBa1952eCdbA02de66fCf73f29068e8cf072644ec'
      OTOKEN_FACTORY_BLOCK: 24287601
      OPTION_HANDLER: '0xc63717c4436043781a63C8c64B02Ff774350e8F8'
      OPTION_HANDLER_BLOCK: 105499855
      VOLATILITY_FEED: '0xF204B60A98B3be05914AeC46bcEd2476D13a0225'
      VOLATILITY_FEED_BLOCK: 105497016
      WHITELIST: '0x84CaCC4103CeE1Da9b79f9Ed0Ed97414240D9c6F'
      WHITELIST_BLOCK: 24287660

      CHAINLINK_AGGREGATOR_ARB_USD: '0xb2a824043730fe05f3da2efafa1cbbe83fa548d6'
      CHAINLINK_AGGREGATOR_ETH_USD: '0x639Fe6ab55C921f74e7fac1ee960C0B6293ba612'
      LIQUIDITY_POOL_OLD: '0xc10b976c671ce9bff0723611f01422acbae100a5'
      OPTION_EXCHANGE_OLD: '0x04706de6ce851a284b569ebae2e258225d952368'
      OPTION_REGISTRY: '0x8bc23878981a207860ba4b185fd065f4fd3c7725'
      MARGIN_POOL: '0xb9f33349db1d0711d95c1198acba9511b8269626'
      TREASURY: '0xc051b37c2b4f103d397074eee54573765df83a72'

      ARB: '0x912ce59144191c1204e64559fe8253a0e49e6548'
      USDC: '0xaf88d065e77c8cc2239327c5edb3a432268e5831'
      WETH: '0x82af49447d8a07e3bd95bd0d56f35241523fbab1'

    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          cache: 'yarn'

      - name: Install modules
        run: yarn -D

      - name: Build
        run: yarn build:ci

      - name: Deploy
        run: yarn deploy:one
